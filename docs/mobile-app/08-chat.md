# Система чатов 💬

## Описание
Три типа чатов: личные, групповые (сообщество), чат ивента. Доступ через иконку в хедере. На старте — только текстовые сообщения (без фото/видео/голосовых).

## Типы чатов

| Тип | Создание | Участники | Модерация |
|-----|----------|-----------|-----------|
| Личный (1 на 1) | Кнопка «Написать» в профиле | 2 игрока | Нет |
| Групповой сообщества | Автоматически при создании сообщества | Все члены сообщества | Админ/Модератор |
| Чат ивента | Автоматически при создании ивента | Участники ивента | Организатор |

## Экран списка чатов

```
┌─────────────────────────────────────────┐
│  ←  Чаты                               │
├─────────────────────────────────────────┤
│  🔍 Поиск...                           │
│                                         │
│  ┌──────────┐┌──────────┐┌──────────┐  │
│  │ Личные   ││  Группы  ││ Ивенты   │  │
│  │   (3)    ││   (1)    ││   (2)    │  │
│  └──────────┘└──────────┘└──────────┘  │
│                                         │
│  ── Таб: Личные ──                     │
│  ┌─────────────────────────────────┐    │
│  │ 👤 Марат Касымов       14:30  │    │
│  │ Давай завтра в 18:00?    ● 2  │    │
│  ├─────────────────────────────────┤    │
│  │ 👤 Айгерим Нурланова   Вчера  │    │
│  │ Ок, записалась на турнир       │    │
│  └─────────────────────────────────┘    │
│                                         │
│  ── Таб: Группы ──                     │
│  ┌─────────────────────────────────┐    │
│  │ 🏛 Tennis Club Astana   12:00  │    │
│  │ Админ: Тренировка отменяется ●│    │
│  └─────────────────────────────────┘    │
│                                         │
│  ── Таб: Ивенты ──                     │
│  ┌─────────────────────────────────┐    │
│  │ 🎾 Весенний турнир NTC  11:45  │    │
│  │ Дамир: Во сколько сбор?   ● 5 │    │
│  └─────────────────────────────────┘    │
└─────────────────────────────────────────┘
```

## Экран чата

```
┌─────────────────────────────────────────┐
│  ←  Марат Касымов          📞  ℹ️      │
├─────────────────────────────────────────┤
│                                         │
│  ┌──────────────────────┐               │
│  │ Привет! Свободен     │               │
│  │ завтра на игру?      │               │
│  │              14:28   │               │
│  └──────────────────────┘               │
│                                         │
│               ┌──────────────────────┐  │
│               │ Привет! Да, давай   │  │
│               │ в 18:00 на NTC      │  │
│               │        14:30  ✓✓   │  │
│               └──────────────────────┘  │
│                                         │
│  ┌──────────────────────┐               │
│  │ Отлично, записал.    │               │
│  │ До завтра!           │               │
│  │              14:31   │               │
│  └──────────────────────┘               │
│                                         │
├─────────────────────────────────────────┤
│  ┌─────────────────────────────┐ [📨]  │
│  │ Сообщение...               │        │
│  └─────────────────────────────┘        │
└─────────────────────────────────────────┘
```

## Функциональность

### Сообщения
- Текстовые сообщения (без лимита длины, но рекомендация ≤ 2000 символов)
- Статусы: отправлено (✓) / доставлено (✓✓) / прочитано (✓✓ синие)
- Время отправки
- Цитирование сообщений (reply, swipe right)
- Удаление своих сообщений (в течение 24 часов)

### Групповой чат (дополнительно)
- Показ имени отправителя
- Закреплённое сообщение (только для админов/модераторов)
- Кнопка ℹ️ → информация о чате: участники, правила
- Мьют чата (отключение уведомлений для конкретного чата)

### Чат ивента
- Создаётся автоматически при публикации ивента
- Участники добавляются при записи на ивент
- Архивируется после завершения ивента (read-only)
- Организатор имеет право модерации

## Техническая реализация

### WebSocket
- Подключение при открытии экрана чата
- Reconnect с exponential backoff (1s, 2s, 4s, 8s, max 30s)
- Heartbeat каждые 30 секунд
- Offline queue: сообщения сохраняются локально и отправляются при восстановлении связи

### Хранение
- Последние 100 сообщений кэшируются локально (SQLite / MMKV)
- Подгрузка истории: пагинация по 50 сообщений (scroll up)
- Медиа: на текущем этапе не поддерживается

### Push-уведомления для чата
- Новое сообщение в личном чате → push
- Упоминание в групповом чате → push (если будет реализовано)
- Замьюченные чаты → без push

## Ограничения (MVP)
- Только текст (без фото, видео, голосовых)
- Без реакций на сообщения
- Без forward сообщений
- Без поиска по истории чата
- Без редактирования отправленных сообщений
