# Авторизация, онбординг, регистрация

## 1. Splash Screen
- Логотип приложения на брендовом фоне
- Длительность: 1-2 секунды
- Проверка: есть ли сохранённый токен → если да, попытка auto-login

## 2. Онбординг (3-4 экрана)
Показывается только при первом запуске. Можно пропустить кнопкой «Пропустить» в правом верхнем углу.

### Экран 1: «Найди партнёра»
- Иллюстрация: два игрока на корте
- Текст: «Найди партнёра для игры за 30 секунд. Больше никаких чатов в WhatsApp!»

### Экран 2: «Присоединяйся к сообществу»
- Иллюстрация: группа игроков
- Текст: «Клубы, лиги и группы — всё теннисное сообщество Астаны в одном месте»

### Экран 3: «Отслеживай прогресс»
- Иллюстрация: графики и рейтинг
- Текст: «Рейтинг, статистика, достижения — видь свой рост как теннисиста»

### Экран 4 (финальный): CTA
- Кнопка «Начать» → переход к авторизации

## 3. Авторизация (SMS OTP)

### Экран: Ввод телефона
```
┌──────────────────────────────────┐
│                                  │
│     [Логотип]                    │
│                                  │
│     Введите номер телефона       │
│                                  │
│  🇰🇿 +7 ┌──────────────────┐   │
│          │ (___) ___-__-__   │   │
│          └──────────────────┘   │
│                                  │
│     Мы отправим SMS с кодом      │
│                                  │
│  ┌──────────────────────────┐    │
│  │      Продолжить          │    │
│  └──────────────────────────┘    │
│                                  │
│  Продолжая, вы соглашаетесь     │
│  с Условиями и Политикой        │
└──────────────────────────────────┘
```

**Логика:**
- Формат номера: +7 (XXX) XXX-XX-XX (казахстанский)
- Маска ввода с автоформатированием
- Валидация: 10 цифр после +7
- При нажатии «Продолжить» → отправка SMS OTP
- Rate limit: 3 SMS в час на один номер
- Кнопка активна только при валидном номере

### Экран: Ввод SMS-кода
```
┌──────────────────────────────────┐
│  ←                               │
│                                  │
│     Введите код из SMS           │
│     Отправлен на +7 707 ***-**-12│
│                                  │
│     ┌──┐ ┌──┐ ┌──┐ ┌──┐         │
│     │  │ │  │ │  │ │  │         │
│     └──┘ └──┘ └──┘ └──┘         │
│                                  │
│     Отправить повторно (0:59)    │
│                                  │
└──────────────────────────────────┘
```

**Логика:**
- 4-значный код
- Автофокус на первое поле
- Автоматическое чтение SMS (Android: SMS Retriever API)
- Автоматическая отправка при вводе 4-й цифры
- Таймер повторной отправки: 60 секунд
- Максимум 5 попыток ввода, потом блокировка на 30 минут
- Код живёт 5 минут

### Логика после успешного OTP:
1. **Новый пользователь** → переход к созданию профиля
2. **Существующий пользователь** → проверка PIN (если установлен) или вход в приложение

## 4. PIN-код (опциональный)

### Установка PIN (после первой регистрации)
```
┌──────────────────────────────────┐
│                                  │
│     Установите PIN-код           │
│     Для быстрого входа           │
│                                  │
│     ┌──┐ ┌──┐ ┌──┐ ┌──┐         │
│     │  │ │  │ │  │ │  │         │
│     └──┘ └──┘ └──┘ └──┘         │
│                                  │
│     Пропустить                   │
│                                  │
└──────────────────────────────────┘
```
- 4 цифры
- Подтверждение: повторный ввод
- Можно пропустить
- Хранение: react-native-keychain (iOS Keychain / Android Keystore)

### Ввод PIN (при повторном входе)
- Показывается если токен истёк, но устройство запомнено
- 3 попытки, после — запрос SMS OTP заново
- Кнопка «Забыли PIN?» → запрос нового SMS

## 5. Создание профиля (первая регистрация)

### Шаг 1: Основные данные
```
┌──────────────────────────────────┐
│  ←                   Шаг 1/3    │
│                                  │
│     Расскажите о себе           │
│                                  │
│  Имя        ┌──────────────┐    │
│              │              │    │
│              └──────────────┘    │
│  Фамилия    ┌──────────────┐    │
│              │              │    │
│              └──────────────┘    │
│  Пол        ○ Мужской ○ Женский │
│                                  │
│  Год рождения ┌────────────┐    │
│               │ 1990    ▼  │    │
│               └────────────┘    │
│  Город/район  ┌────────────┐    │
│               │ Астана   ▼ │    │
│               └────────────┘    │
│                                  │
│  ┌──────────────────────────┐    │
│  │      Продолжить          │    │
│  └──────────────────────────┘    │
└──────────────────────────────────┘
```

**Обязательные поля:** имя, фамилия, пол, год рождения, город/район
**Опциональные:** фото профиля (можно добавить позже)

### Шаг 2: Определение уровня (Skill Quiz)
```
┌──────────────────────────────────┐
│  ←                   Шаг 2/3    │
│                                  │
│     Определим ваш уровень       │
│     Ответьте на 3-5 вопросов    │
│                                  │
│  Вопрос 1 из 5                  │
│                                  │
│  Как давно вы играете в теннис? │
│                                  │
│  ┌──────────────────────────┐    │
│  │ Меньше 6 месяцев         │    │
│  └──────────────────────────┘    │
│  ┌──────────────────────────┐    │
│  │ 6 месяцев – 2 года       │    │
│  └──────────────────────────┘    │
│  ┌──────────────────────────┐    │
│  │ 2–5 лет                  │    │
│  └──────────────────────────┘    │
│  ┌──────────────────────────┐    │
│  │ Более 5 лет              │    │
│  └──────────────────────────┘    │
└──────────────────────────────────┘
```

**Примерные вопросы:**
1. Как давно вы играете в теннис?
2. Можете ли вы стабильно подавать и держать розыгрыш из 5+ ударов?
3. Используете ли вы вращение (топспин, слайс)?
4. Играете ли вы на счёт (с судейством) регулярно?
5. Участвовали ли вы в официальных турнирах?

**Маппинг на NTRP (внутренний):**
- Ответы → weighted score → NTRP уровень
- 1.0–2.0: Начинающий
- 2.5–3.0: Любитель
- 3.5–4.0: Продвинутый
- 4.5+: Профи
- Пользователь видит понятное название, внутренне хранится NTRP число

### Шаг 3: Результат и завершение
```
┌──────────────────────────────────┐
│                   Шаг 3/3       │
│                                  │
│     🎾 Ваш уровень:            │
│                                  │
│     ┌──────────────────────┐    │
│     │   ЛЮБИТЕЛЬ           │    │
│     │   NTRP 3.0           │    │
│     │                      │    │
│     │  Вы уверенно держите │    │
│     │  розыгрыш и можете   │    │
│     │  играть на счёт      │    │
│     └──────────────────────┘    │
│                                  │
│  Уровень будет уточняться       │
│  по мере ваших игр на платформе │
│                                  │
│  ┌──────────────────────────┐    │
│  │      Начать играть!      │    │
│  └──────────────────────────┘    │
└──────────────────────────────────┘
```

## 6. Безопасность

### Хранение токенов
- **Access Token (JWT)**: в памяти приложения, TTL 15 минут
- **Refresh Token**: в react-native-keychain (аппаратное шифрование), TTL 30 дней
- **PIN**: хэш в react-native-keychain
- **Никогда** не использовать AsyncStorage для чувствительных данных

### Rate Limiting
- SMS отправка: 3 в час / 10 в день на номер
- OTP проверка: 5 попыток за сессию
- PIN проверка: 3 попытки
- Регистрация: 3 аккаунта с одного устройства в час

### Автоматический выход
- Refresh token истёк → экран ввода телефона
- Устройство запомнено + PIN установлен → экран PIN
- Устройство запомнено + нет PIN → запрос SMS OTP
