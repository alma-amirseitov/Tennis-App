# Управление участниками 👥

## Описание
Таблица участников сообщества с фильтрацией, сортировкой, массовыми действиями и управлением ролями. Включает управление заявками на вступление.

## Layout

```
┌──────────────────────────────────────────────────────────────────┐
│  👥 Участники (156)              [Участники] [Заявки (5)]       │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│  🔍 Поиск по имени...   [Уровень ▼] [Роль ▼] [Статус ▼]       │
│                                                                  │
│  [Выбрано: 3]  [📩 Уведомление] [🔄 Роль] [📥 Экспорт CSV]    │
│                                                                  │
│  ┌────┬──────────────┬───────┬────────┬──────┬──────────┬──────┐│
│  │ ☐  │ Имя          │ NTRP  │ Рейтинг│ Роль │ Послед.  │  ⋮  ││
│  ├────┼──────────────┼───────┼────────┼──────┼──────────┼──────┤│
│  │ ☐  │ 👤 Алмас Б.  │  3.5  │  1320  │Админ │ Сегодня  │  ⋮  ││
│  │ ☐  │ 👤 Сара М.   │  3.0  │  1180  │Участн│ Вчера    │  ⋮  ││
│  │ ☑  │ 👤 Марат Т.  │  2.5  │  1050  │Участн│ 3 дн.    │  ⋮  ││
│  │ ☐  │ 👤 Дина К.   │  4.0  │  1450  │Модер │ Сегодня  │  ⋮  ││
│  │ ...│              │       │        │      │          │      ││
│  └────┴──────────────┴───────┴────────┴──────┴──────────┴──────┘│
│                                                                  │
│  Показано 1-20 из 156                    [← 1 2 3 ... 8 →]     │
└──────────────────────────────────────────────────────────────────┘
```

## Таблица участников

### Колонки

| Колонка | Тип | Сортировка | Фильтр | Описание |
|---------|-----|-----------|--------|----------|
| ☐ | Checkbox | — | — | Множественный выбор для массовых действий |
| Аватар + Имя | Avatar + text | ✓ А-Я | Поиск (по имени, фамилии, телефону) | Аватар 32px + ФИ + телефон под именем (мелкий шрифт) |
| NTRP | Badge | ✓ числовая | Multi-select: 1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0+ | Цветной badge |
| Рейтинг | Number | ✓ числовая | Range slider (min-max) | Число, жирный шрифт |
| Роль | Badge | ✓ | Multi-select: owner, admin, moderator, member | Цветные badges: owner=purple, admin=blue, moderator=green, member=gray |
| Игр | Number | ✓ числовая | Range (min-max) | Кол-во матчей в этом сообществе |
| Дата вступления | Date | ✓ | Date range picker | Relative: "Сегодня", "3 дн. назад", "12 Янв" |
| Последняя активность | Date | ✓ | Date range picker | Relative format |
| ⋮ | Actions menu | — | — | Dropdown с действиями |

### Фильтры (toolbar)

```
[🔍 Поиск...]  [NTRP ▼]  [Роль ▼]  [Активность ▼]  [✕ Сбросить фильтры]
```

- Поиск: debounce 300ms, ищет по first_name, last_name, phone
- NTRP: multi-select dropdown с чекбоксами
- Роль: multi-select dropdown
- Активность: dropdown — "Все", "Активные (7 дн.)", "Активные (30 дн.)", "Неактивные (>30 дн.)"

### Пагинация

- 20 записей на страницу (опционально: 20, 50, 100)
- Компонент: Shadcn Pagination
- "Показано 1-20 из 156"

## Действия

### Массовые действия (при выделении ≥1 строки)

Toolbar появляется над таблицей:
```
[Выбрано: 3 участника]  [📩 Уведомление]  [🔄 Изменить роль]  [📥 CSV]
```

| Действие | Описание | Подтверждение |
|----------|---------|---------------|
| Отправить уведомление | Модал: текст + заголовок → push всем выбранным | Нет |
| Изменить роль | Dropdown: member, moderator, admin | Да: "Назначить 3 участников модераторами?" |
| Экспорт CSV | Скачать выбранных в CSV | Нет |

### Индивидуальные действия (⋮ меню)

| Действие | Доступно | Описание |
|----------|---------|----------|
| 👤 Профиль | Всем ролям | Открывает детальный профиль в sidepanel |
| 💬 Написать | Всем ролям | Открывает чат в мобайле (deep link) |
| 🔄 Изменить роль | owner, admin | Dropdown: member ↔ moderator ↔ admin |
| ⏸️ Временный бан | owner, admin | Модал: срок (1д/7д/30д) + причина |
| 🚫 Постоянный бан | owner, admin | Модал подтверждения + причина |
| 🗑 Удалить из сообщества | owner, admin | Модал подтверждения |

### Детальный профиль (side panel)

При клике на имя — выезжает панель справа:

```
┌──────────────────────────┐
│  ← Профиль участника     │
│                          │
│  [Аватар 80px]           │
│  Алмас Бекмухамедов      │
│  +7 707 123 4567         │
│                          │
│  NTRP: 3.5               │
│  Рейтинг: 1320 (#12)    │
│  Роль: Админ             │
│  Вступил: 15 Янв 2026    │
│                          │
│  ── Статистика ──        │
│  Матчей: 23              │
│  Побед: 15 (65%)         │
│  Ивентов: 18             │
│                          │
│  ── Последние матчи ──   │
│  vs Сара М. 6:4 6:3 W    │
│  vs Марат Т. 3:6 4:6 L   │
│  vs Дина К. 7:5 6:4 W    │
│                          │
│  [💬 Написать] [🔄 Роль] │
└──────────────────────────┘
```

## Вкладка "Заявки"

Для закрытых сообществ (access_type = closed).

```
┌────────────────────────────────────────────────────────────┐
│  Заявки на вступление (5)                [Одобрить все]    │
├────────────────────────────────────────────────────────────┤
│                                                            │
│  ┌────────────────────────────────────────────────────┐    │
│  │ 👤 Алмас Б.  │  NTRP 3.0  │  Рейтинг 1150       │    │
│  │ Подал заявку: 2 часа назад                        │    │
│  │ Сообщение: "Хочу присоединиться к турнирам"       │    │
│  │ Состоит в: Tennis Club Astana, Weekend Tennis      │    │
│  │                                                    │    │
│  │              [✓ Принять]  [✕ Отклонить]            │    │
│  └────────────────────────────────────────────────────┘    │
│                                                            │
│  ┌────────────────────────────────────────────────────┐    │
│  │ 👤 Сара М.   │  NTRP 2.5  │  Рейтинг 1050       │    │
│  │ Подала заявку: 5 часов назад                      │    │
│  │ Сообщение: —                                      │    │
│  │ Состоит в: —                                      │    │
│  │                                                    │    │
│  │              [✓ Принять]  [✕ Отклонить]            │    │
│  └────────────────────────────────────────────────────┘    │
│                                                            │
│  Показано 1-5 из 5                                        │
└────────────────────────────────────────────────────────────┘
```

Каждая заявка показывает:
- Аватар + имя
- NTRP уровень + рейтинг
- Время подачи (relative)
- Сообщение (если есть)
- В каких сообществах состоит (для оценки)
- 2 кнопки: Принять / Отклонить

"Одобрить все" — массовое принятие (с подтверждением).

## Приглашения

Секция под таблицей или отдельный таб.

| Способ | Описание | UI |
|--------|---------|-----|
| Invite link | Генерация ссылки с TTL (7/30 дн. или бессрочная) | Button → copy link |
| По номеру | Ввод телефона, если есть на платформе → отправка push invite | Input + button |
| CSV import | Загрузка CSV с номерами → массовое приглашение | File upload |

## API Endpoints

```
GET  /v1/admin/communities/:id/members?page=1&per_page=20&search=...&role=...&level_min=...&sort_by=rating&sort_order=desc
POST /v1/admin/communities/:id/members/:user_id/role   {"role": "moderator"}
POST /v1/admin/communities/:id/members/:user_id/ban    {"type": "temporary", "days": 7, "reason": "..."}
DELETE /v1/admin/communities/:id/members/:user_id

GET  /v1/admin/communities/:id/requests
POST /v1/admin/communities/:id/requests/:user_id/approve
POST /v1/admin/communities/:id/requests/:user_id/reject

POST /v1/admin/communities/:id/invite-link  {"ttl_days": 7}
POST /v1/admin/communities/:id/invite       {"phone": "+77071234567"}
```

## Компоненты (Shadcn/UI)

- Table + TanStack Table (sorting, filtering, pagination)
- Checkbox (для выбора)
- DropdownMenu (actions)
- Badge (roles, levels)
- Sheet (side panel)
- AlertDialog (подтверждения)
- Dialog (модалы: ban, notification)
- Input + Select (фильтры)
- Pagination
